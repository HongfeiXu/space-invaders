# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

**Space Invaders** is a 2D arcade-style game built with Phaser 3 and Webpack 5. It's a fully functional, deployable game prototype that runs on GitHub Pages.

- **Live URL**: https://hongfeixu.github.io/space-invaders/
- **Repository**: https://github.com/HongfeiXu/space-invaders
- **Status**: Fully playable, deployed to production

### Core Technology Stack

- **Framework**: Phaser 3.90.0 (Arcade Physics engine)
- **Build Tool**: Webpack 5.102.1 with HtmlWebpackPlugin
- **Language**: JavaScript (CommonJS module system)
- **Deployment**: GitHub Pages (build outputs in `/docs` folder)
- **Resolution**: 800x600 fixed canvas

---

## Quick Start Commands

```bash
# Install dependencies
npm install

# Development server with hot reload (port 8080)
npm start

# Production build (outputs to /docs, minified HTML)
npm run build
```

**Important deployment workflow**:
```bash
# 1. Make changes and test locally
npm start

# 2. Build for production (updates /docs)
npm run build

# 3. Commit and push to GitHub
git add .
git commit -m "Clean and Brief message"
git push origin main
# GitHub Pages auto-deploys from /docs folder (~1-2 minutes)
```

**Never skip step 2**: GitHub Pages serves from `/docs`, so changes are only live after `npm run build`.

---

## Project Structure

```
project_1/
├── src/                          # Game source code (CommonJS)
│   ├── index.js                  # Phaser config, PreloadScene, texture generation
│   └── scenes/
│       └── GameScene.js          # Main game logic (237 lines)
│
├── public/
│   └── index.html                # HTML template (processed by HtmlWebpackPlugin)
│
├── docs/                         # Build output (GitHub Pages deploy source)
│   ├── index.html                # Generated by HtmlWebpackPlugin
│   └── main.js                   # Bundled + minified game code
│
├── documentation/                # Project documentation
│   ├── PLAN.md                   # Development plan and roadmap
│   ├── PROGRESS.md               # Development history and current status
│   └── memos/                    # Detailed guides & reference docs
│       ├── GUIDE.md              # Development guide with examples
│       ├── DEPLOYMENT_ISSUES.md  # GitHub Pages deployment troubleshooting
│       ├── WEBPACK_CONFIG.md     # Webpack and build system details
│       └── DEPLOYMENT.md         # Manual deployment guide
│
├── webpack.config.js             # Webpack configuration
├── package.json                  # Dependencies and scripts
└── .gitignore                    # Git exclusions
```

---

## ⚠️ IMPORTANT: File Organization Rules

**Markdown File Storage Policy**

When creating or modifying markdown files in this project, follow this rule:

### Default Location: `documentation/memos/`
- **ALL new markdown files** should be created in `documentation/memos/` by default
- This includes guides, references, technical documentation, and memo notes
- Examples: guides, API docs, troubleshooting, configuration explanations, etc.

### Current Directory Layout
| Location | Purpose | Examples |
|----------|---------|----------|
| `README.md` (root) | Game overview for players | Game rules, features, quick start |
| `CLAUDE.md` (root) | Claude AI project guidance | This file - instructions for AI assistants |
| `documentation/PLAN.md` | Development roadmap | High-level plans, next steps |
| `documentation/PROGRESS.md` | Development history | How the project was built, milestones |
| **`documentation/memos/`** | **Detailed technical guides** | **Code examples, deployment details, configuration, troubleshooting** |

### Exception Rule
Only create files in other locations (root or `documentation/` directly) if:
- User explicitly requests it, OR
- File serves as a high-level overview/navigation document

**Example of correct usage**:
- ✅ New coding guide → `documentation/memos/CODING_GUIDE.md`
- ✅ New troubleshooting → `documentation/memos/TROUBLESHOOTING.md`
- ❌ New guide in root → `/GUIDE.md` (should be in memos)
- ❌ New memo in documentation → `documentation/MEMO.md` (should be in memos)

---

## Core Architecture

### Two-Scene Phaser Architecture

1. **PreloadScene** (`src/index.js`)
   - Generates in-memory graphics textures using Phaser Graphics API
   - Creates 4 texture types: player (white triangle), enemy (green rect), playerBullet (yellow), enemyBullet (red)
   - Transitions to GameScene after texture creation
   - No external image files needed—everything is procedurally generated

2. **GameScene** (`src/scenes/GameScene.js`)
   - Main gameplay loop with Phaser lifecycle methods: `create()`, `update()`, and custom methods
   - Manages all game entities: player, enemies, bullets
   - Handles physics, collisions, input, animations, and game state

### Game State Management Pattern

The GameScene uses instance variables to track state:
```javascript
this.score = 0          // Track player score
this.lives = 3          // Track remaining lives
this.gameOver = false   // Game end state
this.isPaused = false   // Pause state
this.lastShotTime = 0   // Cooldown tracking for player shooting
this.difficulty = 1     // (Future) difficulty multiplier
```

### Physics and Collision System

Uses Phaser Arcade Physics groups for efficient collision detection:
- `this.enemies` - Physics group for all enemies
- `this.playerBullets` - Physics group for player bullets
- `this.enemyBullets` - Physics group for enemy bullets

Overlaps are registered in `create()`:
```javascript
this.physics.add.overlap(playerBullets, enemies, hitEnemy, null, this)
this.physics.add.overlap(player, enemyBullets, hitPlayer, null, this)
this.physics.add.overlap(player, enemies, hitPlayer, null, this)
```

### Animation System

Uses Phaser Tween system for effects:
- Enemy hit animation: Tween alpha (transparency) with yoyo effect for 640ms
- Creates visual feedback without frame-based animations

---

## Key Game Parameters

All modifiable parameters are in `src/scenes/GameScene.js`:

| Parameter | Value | Location | Usage |
|-----------|-------|----------|-------|
| Player speed | 250 px/s | `update()` L93-96 | Arrow key movement |
| Shoot cooldown | 250 ms | `playerShoot()` L126 | Rate limiter (prevent spam) |
| Enemy speed | ±50 px/s | `spawnEnemies()` L111 | Horizontal random movement |
| Enemy shoot interval | 1000 ms | `create()` L67 | Timer event loop |
| Enemy blink duration | 80 ms × 3 repeats | `hitEnemy()` L145-146 | Tween animation |
| Initial lives | 3 | `create()` L14 | Game state init |
| Points per enemy | 10 | `hitEnemy()` L154 | Score increment |
| Canvas resolution | 800×600 | `src/index.js` L54-55 | Game dimensions |

**To modify**: Simply change the numeric values in the specified locations.

---

## GameScene Method Reference

### Lifecycle & Core

- **`create()`** - Initializes everything: UI, player, enemies, physics, input, timers
- **`update()`** - Per-frame loop (60 FPS): handles player movement, shooting, bullet cleanup

### Input & Actions

- **`playerShoot()`** - Creates player bullet with 250ms cooldown check
- **`togglePause()`** - ESC key handler: pauses/resumes physics and toggles pause UI text

### Game Logic

- **`spawnEnemies()`** - Creates 3×5 grid of enemies with random horizontal velocities
- **`enemyShoot()`** - Timer callback: randomly selected enemy fires downward
- **`hitEnemy(callback)`** - Collision handler: triggers Tween flash animation, then destroys enemy and adds score
- **`hitPlayer(callback)`** - Collision handler: decrements lives, checks game over condition
- **`endGame()`** - Displays game over screen with restart button

---

## Build System: Webpack + HtmlWebpackPlugin

### Key Configuration (`webpack.config.js`)

**Entry/Output**:
- Entry: `./src/index.js`
- Output: `./docs/main.js` (GitHub Pages source)
- PublicPath: `/space-invaders/` in production, `/` in dev

**HtmlWebpackPlugin**:
- Template: `./public/index.html`
- Auto-generates `./docs/index.html` with injected `<script>` tag
- Production: Minifies HTML (removes comments, collapses whitespace)
- Development: Unminified for easier debugging

**Dev Server**:
- Port: 8080
- Static files served from: `./public/`
- Auto-opens browser on `npm start`

### Build Output

- `npm run build` produces:
  - `docs/main.js` (~1.14 MB minified, includes all dependencies)
  - `docs/index.html` (~700 B, auto-generated)
  - `docs/main.js.LICENSE.txt` (license info for bundled packages)

### Why `/docs` Folder?

GitHub Pages has limited folder options: only `/ (root)` or `/docs`. We chose `/docs` because:
- Clean separation: build outputs in `/docs`, documentation in `/documentation`
- GitHub standard practice for static sites
- Avoids committing `dist/` which is typically gitignored

---

## Important Development Notes

### Module System: CommonJS

The project uses **CommonJS** (`require`/`module.exports`) instead of ES6 modules:
- Webpack handles bundling transparently
- No Babel configuration needed
- Simpler setup for quick prototyping
- Trade-off: Not ideal for very large projects (ES6 modules more scalable)

**Never use ES6 import/export syntax** in this project.

### Asset Loading Strategy

Instead of external image files, the game generates textures procedurally:

```javascript
// In PreloadScene.create()
const graphics = this.make.graphics({ x: 0, y: 0, add: false })
graphics.fillStyle(0xffffff)  // White color
graphics.fillRect(0, 0, 30, 30)  // Rectangle shape
graphics.generateTexture('textureName', 30, 30)  // Create texture
graphics.destroy()  // Clean up
```

**Benefit**: No external assets to manage, easy to customize colors/shapes.

### HTML Template & Script Injection

**Critical**: The `public/index.html` template should NOT have a manual `<script src="main.js">` tag.

HtmlWebpackPlugin automatically injects the correct script based on mode:
- Development: `<script src="/main.js"></script>`
- Production: `<script src="/space-invaders/main.js"></script>` (with publicPath)

Manually adding script tags causes double-loading (duplicate game instances).

---

## Deployment Workflow

### Standard Development → GitHub Pages Pipeline

**Step 1: Local Development & Testing**
```bash
npm start  # Run dev server at http://localhost:8080
# Make changes, test locally with hot reload
# Stop with Ctrl+C when done
```

**Step 2: Build for Production**
```bash
npm run build  # Creates/updates /docs folder with minified code & HTML
# Verify build succeeded (no errors in output)
```

**Step 3: Commit & Push**
```bash
git status  # Review changes
git add .
git commit -m "Clear description of changes"
git push origin main
```

**Step 4: GitHub Pages Auto-Deploy**
- Source: `main` branch, `/docs` folder
- Live URL: https://hongfeixu.github.io/space-invaders/
- Deployment time: Usually 1-2 minutes after push
- Verify: Visit URL and test game in browser

### Critical: Always Build Before Pushing

GitHub Pages reads from `/docs` folder. If you skip `npm run build`, your changes won't appear on the live site.

### Common Issues & Solutions

See `documentation/DEPLOYMENT_ISSUES.md` for:
- 404 errors (missing HTML file)
- GitHub Pages folder selection (GitHub only supports `/` or `/docs`)
- Build output not updating (forgot to run `npm run build`)

---

## Code Quality Practices

### Current State

✅ **Strong points**:
- Clear separation of concerns (Scene pattern)
- Efficient collision detection (physics groups)
- Working animations (Tween system)
- Deployed and live

⚠️ **Known limitations** (planned improvements):
- Magic numbers scattered in code (should extract to config file)
- Object pool not optimized (destroys bullets, could reuse them)
- No automated tests

### Future Enhancements (Priority Order)

1. **Config extraction** (HIGH) - Move parameters to `src/config/GameConfig.js`
2. **Object pooling** (HIGH) - Recycle bullets instead of destroying
3. **Difficulty scaling** (MEDIUM) - Progressive enemy speed/fire rate
4. **Sound effects** (MEDIUM) - Use Phaser Sound API
5. **Enemy AI** (LOW) - Target-based shooting instead of random
6. **High scores** (LOW) - localStorage persistence
7. **Responsive design** (LOW) - Mobile-friendly canvas sizing

See `documentation/GUIDE.md` for code examples for each enhancement.

---

## Testing & Debugging

### During Development

1. **Webpack dev server hotloading**:
   - Changes to `src/` files auto-reload in browser (~30ms)
   - No manual refresh needed

2. **Browser DevTools**:
   - Open DevTools (F12)
   - Console: Check for any errors
   - Can directly inspect game state in Sources tab

3. **Physics debug visualization**:
   - In `src/index.js`, change `debug: false` to `debug: true`
   - Shows collision bodies as outlines
   - Helpful for collision issues

4. **Console logging**:
   ```javascript
   console.log('Enemies:', this.enemies.children.entries.length)
   console.log('Score:', this.score)
   // Check DevTools Console during gameplay
   ```

### Build Verification

Always test production build locally before pushing:
```bash
npm run build
# Then manually test: open file:///docs/index.html (or use local server)
# Verify: HtmlWebpackPlugin injected correct script path
```

---

## Documentation Map

| File | Purpose | Read When |
|------|---------|-----------|
| `../README.md` | Project overview, features, tech stack | First time setup |
| `PLAN.md` | Development roadmap & next steps | Planning next features |
| `PROGRESS.md` | Development history & architecture decisions | Understanding project evolution |
| `memos/GUIDE.md` | Development examples, game parameters, modification guides | Making changes |
| `memos/DEPLOYMENT_ISSUES.md` | GitHub Pages problems & solutions | Debugging deployment issues |
| `memos/WEBPACK_CONFIG.md` | Build system & HtmlWebpackPlugin details | Modifying build pipeline |
| `memos/DEPLOYMENT.md` | Manual deployment guide | Alternative deployment methods |

---

## Useful Git Workflow

```bash
# Check status before committing
git status
git diff  # See changes

# Common flow
git add .
git commit -m "Clear, descriptive message"
git push origin main

# View recent commits
git log --oneline -10
```

**Tip**: The project has a clean git history. Keep commit messages concise and descriptive.

---

## Performance Metrics

**Current performance** (measured):
- Game code: 237 lines (GameScene.js)
- Build size: 1.14 MB minified (includes Phaser library)
- Load time: ~2s (first load, cached after)
- FPS: 60 stable (even with 50+ enemies)
- Enemy limit: Can handle 50+ before performance degradation (currently spawns 15)

**Browser compatibility**: Modern browsers (Chrome, Firefox, Safari, Edge) - uses Phaser's AUTO renderer (WebGL with Canvas fallback).

---

## File Modification Checklist

When making changes, consider these dependencies:

**If modifying `src/scenes/GameScene.js`**:
- No additional build steps needed
- Changes reload automatically with `npm start`
- Must rebuild with `npm run build` before pushing

**If modifying `src/index.js`**:
- Changes to Phaser config, texture generation, or scene list
- Same build requirements as GameScene

**If modifying `public/index.html`**:
- HtmlWebpackPlugin uses this as template
- Injected script tags should be removed (plugin handles it)
- Rebuild updates `docs/index.html`

**If modifying `webpack.config.js`**:
- Requires webpack restart (stop `npm start`, run again)
- Affects build output and dev server behavior

**If adding dependencies**:
- Run `npm install <package>` or `npm install --save-dev <package>`
- Commit updated `package.json` and `package-lock.json`
- Others must run `npm install` to get dependencies

---

## Phaser 3 API Quick Reference

Common patterns used in this project:

```javascript
// Sprites & movement
sprite.setVelocityX(speed)
sprite.setVelocityY(speed)
sprite.setCollideWorldBounds(true)
sprite.setBounce(0.5)

// Physics groups
group.create(x, y, 'texture')
group.children.entries  // Array of objects in group

// Collision detection
this.physics.add.overlap(group1, group2, callback, null, this)
this.physics.add.collider(group1, group2, callback, null, this)

// Tweens (animations)
this.tweens.add({
  targets: sprite,
  alpha: 0.5,
  duration: 1000,
  repeat: 3,
  yoyo: true  // Reverse animation
})

// Input
this.input.keyboard.createCursorKeys()
this.input.keyboard.on('keydown-SPACE', callback)

// Timers
this.time.addEvent({
  delay: 1000,
  callback: func,
  loop: true
})

// Text & UI
this.add.text(x, y, 'text', { fontSize: '16px', fill: '#fff' })
```

See `documentation/GUIDE.md` for more examples and explanations.

---

## Summary

This is a complete, playable, and deployed game project. The architecture is straightforward:
- **Phaser 3** for game engine
- **Webpack** for bundling
- **GitHub Pages** for hosting
- **CommonJS** for module system
- **Procedural textures** for assets

Focus on game logic in `GameScene.js`. The build system handles the rest. Before pushing changes, always run `npm run build` to update the GitHub Pages source in `/docs`.

For questions about specific features or implementation details, see the documentation files listed above or examine the well-commented source code.

---

*Last updated: 2025-11-12*
