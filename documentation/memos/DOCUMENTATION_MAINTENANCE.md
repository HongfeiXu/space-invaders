# 文档维护指南

详细的文档维护规则和最佳实践。所有开发会话必须遵守。

---

## PLAN.md - 前瞻性路线图

**目的**: 记录未来计划，不记录历史

### 核心规则

| 规则 | 说明 |
|------|------|
| ✅ 保留 | 待实现的功能（未来） |
| ❌ 移除 | 完成的功能（实现后立即删除） |
| ❌ 移除 | ✅ 标记的已完成项 |
| 📏 目标 | 150-200 行（纯路由图） |

### Session 检查清单

在每次会话结束时：

```
- [ ] 将完成的功能从 PLAN.md 中移除
- [ ] 将其添加到 archive/COMPLETED_FEATURES.md
- [ ] 添加下一个要实现的功能到 PLAN.md
- [ ] 确保仅保留下一个 2-3 个优先级可见
- [ ] 运行 npm run build 和提交
```

### 错误实践 ❌

```markdown
## Priority 2 ✅ 已完成（会话 3）
- ✅ 波次系统已实现
- ✅ 背景音乐已添加
```

**问题**: 完成的项目不应该留在规划文档中

### 正确实践 ✅

```markdown
## Priority 2: 音效和视觉效果

#### 2.1 SFX 音效系统
- ❌ 射击音、击中音、爆炸音

#### 2.2 粒子效果
- ❌ 敌人爆炸粒子、碎片飘落
```

**优势**: 清晰的待实现功能列表

---

## PROGRESS.md - 高层次历史

**目的**: 记录"为什么"和"怎样"，不记录"做了什么"

### 核心规则

| 规则 | 说明 |
|------|------|
| ✅ 保留 | 架构决策和技术选择的理由 |
| ✅ 保留 | 重要的洞察和经验教训 |
| ❌ 移除 | 代码片段（git 历史已有） |
| ❌ 移除 | 逐步排查过程（除非涉及架构） |
| ❌ 移除 | 增量变化的表格 |
| 📏 目标 | 每个会话 30-80 行，总共 300-400 行 |

### Session 模板

```markdown
## Session N - 功能名称 (日期)

**影响**: [High/Medium/Low]
**概述**: 1-2 句话总结

### 关键成就
- 成就 1
- 成就 2

### 技术决策
- **决策 1**: 理由说明
- **决策 2**: 理由说明

### 关键洞察
- 洞察 1
- 洞察 2
```

### 错误实践 ❌

```markdown
### Session 1 - 项目初始化

#### 开发历程
| 时间 | 功能 | 代码行 | 提交 |
|------|------|--------|------|
| 0.5h | 项目骨架 | ~100 | ecb2fe3 |
| 0.5h | 敌人系统 | ~150 | ecb2fe3 |
| 0.5h | 得分系统 | ~210 | ecb2fe3 |

### 关键代码片段
```javascript
// 射击冷却
if (!this.lastShotTime) this.lastShotTime = 0
const now = this.time.now
if (now - this.lastShotTime > 250) {
    this.lastShotTime = now
}
```
```

**问题**:
- 表格重复提交信息
- 代码片段会过时
- 细节不适合摘要文档

### 正确实践 ✅

```markdown
## Session 1 - 项目初始化 (2025-11-11)

**影响**: High
**概述**: 从零到可玩的游戏原型（210 行代码）

### 关键成就
- 建立 Phaser 3 + Webpack 5 项目
- 实现基础游戏循环（玩家、敌人、碰撞）
- 创建初始 CommonJS 模块架构

### 技术决策
- **选择 CommonJS**: 避免 Babel 复杂性，加快开发
- **使用 Phaser Groups**: 统一管理多个游戏对象

### 关键洞察
- 魔法数字应提取到配置（为后续优化预留）
```

**优势**:
- 简洁清晰
- 专注于"为什么"
- 架构决策有记录
- 易于维护

### 每个 Session 后

1. 按模板写 PROGRESS.md 条目（30-80 行）
2. 如果有旧会话 (>4 个)，移到 `archive/DETAILED_PROGRESS_SESSIONS_*.md`
3. 只在主 PROGRESS.md 中保留最后 3-4 个会话

---

## 归档政策

### 何时归档

**PLAN.md**:
- 功能完成 → 立即从 PLAN.md 移除
- 移动到 `archive/COMPLETED_FEATURES.md`

**PROGRESS.md**:
- 会话超过 4 个 → 移到 `archive/DETAILED_PROGRESS_SESSIONS_*.md`
- 保留最新 3-4 个会话在主文件

### 归档结构

```
documentation/archive/
├── COMPLETED_FEATURES.md              # 所有已完成功能
├── DETAILED_PROGRESS_SESSIONS_1-5.md  # 完整会话细节
├── DETAILED_PROGRESS_SESSIONS_6-10.md # （未来）
└── ...
```

### 为什么归档？

✅ 保留所有历史信息（无数据丢失）
✅ 主文档保持精简实用
✅ 新开发者快速找到下一步工作
✅ 减少维护负担

---

## 文档参考表

| 文件 | 目的 | 长度 | 更新频率 |
|------|------|------|---------|
| `CLAUDE.md` | AI 协作指南 | ~150 行 | 每月 |
| `PLAN.md` | 未来路线图 | ~150-200 行 | 每次会话 |
| `PROGRESS.md` | 架构历史 | ~300-400 行 | 每次会话 |
| `README.md` | 玩家指南 | ~100 行 | 偶尔 |
| `memos/*` | 技术深度 | 变量 | 偶尔 |
| `archive/*` | 历史参考 | 变量 | 被动 |

---

## 常见问题

### Q: 旧会话应该保留多久？
**A**: 在主 PROGRESS.md 中保留最后 3-4 个会话。当新会话写入时，将最古老的会话移到 archive/。

### Q: 能否将代码片段放在 PROGRESS.md 中？
**A**: 不建议。Git 历史已经有了代码的完整版本。PROGRESS.md 应该关注"为什么"而非"代码如何"。

### Q: 如果忘记从 PLAN.md 中移除完成的项目怎么办？
**A**: 下个会话开始时补救。这样文件不会无限膨胀。

### Q: 文档长度有硬限制吗？
**A**: 没有硬限制，但指定的目标长度（PLAN 150-200 行，PROGRESS 300-400 行）是最佳实践。

---

## 检查清单（复制粘贴）

### 开发会话开始

- [ ] 阅读 PLAN.md 确认本会话的目标
- [ ] 查看 PROGRESS.md 了解架构决策背景
- [ ] 检查是否有遗留的文档维护工作（旧会话归档）

### 开发会话结束

- [ ] 测试代码并通过
- [ ] 编写简洁的提交消息
- [ ] 更新 PROGRESS.md（按模板）
- [ ] 从 PLAN.md 中移除完成的功能
- [ ] 将完成的功能添加到 archive/COMPLETED_FEATURES.md
- [ ] 如果有 >4 个会话，将最古老的移到 archive/
- [ ] 运行 npm run build
- [ ] 提交和推送

---

*最后更新: 2025-11-17*
