# å†…å­˜æ³„æ¼åˆ†æä¸ä¿®å¤æŠ¥å‘Š

**æ—¥æœŸ**: 2025-11-14
**çŠ¶æ€**: âœ… å·²ä¿®å¤

## é—®é¢˜æ¦‚è¿°

Space Invaders æ¸¸æˆåœ¨åœºæ™¯é‡å¯æ—¶å­˜åœ¨éŸ³ä¹å®ä¾‹æ³„æ¼é—®é¢˜ã€‚é€šè¿‡å®é™…æµ‹è¯•éªŒè¯å¹¶æˆåŠŸä¿®å¤ã€‚

---

## éªŒè¯ç»“æœ

é€šè¿‡æ·»åŠ è°ƒè¯•æ—¥å¿—è¿›è¡Œå®é™…æµ‹è¯•ï¼š

| å¯¹è±¡ | åˆå§‹ | é‡å¯å | ç»“è®º |
|------|------|--------|------|
| **Keyboard listeners** | undefined | æ— å˜åŒ– | âœ… Phaser è‡ªåŠ¨æ¸…ç†ï¼Œæ— æ³„æ¼ |
| **Event names** | Array(12) | æ— å˜åŒ– | âœ… Phaser è‡ªåŠ¨æ¸…ç†ï¼Œæ— æ³„æ¼ |
| **Sound instances** | 1 | 2â†’3â†’4... | ğŸ”´ **æŒç»­å¢é•¿ï¼Œå­˜åœ¨æ³„æ¼** |

---

## ä¿®å¤æ–¹æ¡ˆ

### 1. éŸ³ä¹å®ä¾‹æ³„æ¼ ğŸ”´ å·²ä¿®å¤

**é—®é¢˜**ï¼šæ¯æ¬¡ `create()` åˆ›å»ºæ–°éŸ³ä¹å®ä¾‹ï¼Œæ—§å®ä¾‹æœªè¢«æ¸…ç†ï¼Œå¯¼è‡´ Sound instances æŒç»­å¢é•¿ã€‚

**å¤±è´¥çš„å°è¯•**ï¼š
- âŒ åœ¨ `create()` ä¸­æ£€æŸ¥ `this.backgroundMusic` å¹¶é”€æ¯ â†’ `scene.restart()` åˆ›å»ºæ–°å®ä¾‹ï¼Œ`this` ä¸æŒ‡å‘æ—§å®ä¾‹
- âŒ ä½¿ç”¨ `sound.stopAll()` + `sound.removeAll()` â†’ ä¼šæ¸…é™¤æ‰€æœ‰éŸ³æ•ˆï¼Œä¸å¤Ÿç²¾ç¡®

**æœ€ç»ˆæ–¹æ¡ˆ** (`src/scenes/GameScene.js` L285-288ï¼Œåœ¨ `shutdown()` ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­)ï¼š
```javascript
// åœæ­¢å¹¶é”€æ¯èƒŒæ™¯éŸ³ä¹ï¼ˆé˜²æ­¢å†…å­˜æ³„æ¼ï¼‰
if (this.backgroundMusic) {
    this.backgroundMusic.stop();
    this.backgroundMusic.destroy();
}
```

**ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆæœ‰æ•ˆ**ï¼š
- `shutdown()` åœ¨åœºæ™¯å…³é—­æ—¶è§¦å‘ï¼Œæ—¶æœºæ—©äºæ–°åœºæ™¯çš„ `create()`
- ç”Ÿå‘½å‘¨æœŸé’©å­æ˜¯å¤„ç†èµ„æºæ¸…ç†çš„æ ‡å‡†ä½ç½®
- ç²¾ç¡®é”€æ¯ç‰¹å®šéŸ³ä¹å®ä¾‹ï¼Œä¸å½±å“å…¶ä»–å¯èƒ½çš„éŸ³æ•ˆ
- `destroy()` è™½ç„¶å»¶è¿Ÿä»æ•°ç»„ç§»é™¤ï¼Œä½† Phaser GC ä¼šåœ¨ä¸‹ä¸€å¸§æ¸…ç†

**æ•ˆæœ**ï¼šâœ… Sound instances ç¨³å®šä¿æŒåœ¨ 1ï¼ˆæµ‹è¯•éªŒè¯ï¼šæ¯æ¬¡ shutdown æ—¶æ£€æµ‹åˆ° 1 ä¸ªå®ä¾‹ï¼‰

---

### 2. æš‚åœåŠŸèƒ½æ”¹è¿› ğŸŸ  å·²ä¿®å¤

**é—®é¢˜**ï¼šæ¸¸æˆæš‚åœæ—¶ï¼Œæ•Œäººå°„å‡»å®šæ—¶å™¨ä»åœ¨è¿è¡Œï¼Œå¯¼è‡´æ•Œäººç»§ç»­å°„å‡»ã€‚

**ä¿®å¤ä»£ç ** (`src/scenes/GameScene.js`):
```javascript
// L81-86: ä¿å­˜å®šæ—¶å™¨å¼•ç”¨
this.enemyFireTimer = this.time.addEvent({
    delay: GameConfig.ENEMY.FIRE_INTERVAL,
    callback: this.enemyShoot,
    callbackScope: this,
    loop: true
});

// L114-116, L125-127: æš‚åœ/æ¢å¤å®šæ—¶å™¨
if (this.enemyFireTimer) {
    this.enemyFireTimer.paused = true;  // æš‚åœæ—¶
    // this.enemyFireTimer.paused = false;  // æ¢å¤æ—¶
}
```

**æ•ˆæœ**ï¼šâœ… æš‚åœæ—¶æ•Œäººä¸å†å°„å‡»

---

### 3. ç”Ÿå‘½å‘¨æœŸç®¡ç†æ”¹è¿› ğŸ“ å·²æ·»åŠ 

æ·»åŠ äº† `shutdown` å’Œ `preShutdown` ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œç”¨äºèµ„æºæ¸…ç†ï¼š

```javascript
// src/scenes/GameScene.js L20-21
this.events.on('shutdown', this.shutdown, this);
this.events.on('preShutdown', this.preShutdown, this);

// L287-302
shutdown() {
    // åœæ­¢å¹¶é”€æ¯èƒŒæ™¯éŸ³ä¹
    if (this.backgroundMusic) {
        if (this.backgroundMusic.isPlaying) {
            this.backgroundMusic.stop();
        }
        this.backgroundMusic.destroy();
    }
    // åœæ­¢æ•Œäººå°„å‡»å®šæ—¶å™¨
    if (this.enemyFireTimer) {
        this.enemyFireTimer.remove();
    }
    // ç§»é™¤äº‹ä»¶ç›‘å¬å™¨
    this.events.off('shutdown', this.shutdown, this);
    this.events.off('preShutdown', this.preShutdown, this);
}
```

---

## å…³é”®å­¦ä¹ 

### ä¸ºä»€ä¹ˆä¸ä¼šå¬åˆ°å¤šä¸ªéŸ³é¢‘å åŠ ï¼Ÿ

è™½ç„¶æœ‰å†…å­˜æ³„æ¼ï¼Œä½†**ä¸ä¼š**å¬åˆ°å¤šä¸ªéŸ³é¢‘åŒæ—¶æ’­æ”¾ï¼Œå› ä¸ºï¼š

1. `endGame()` ä¸­è°ƒç”¨äº† `backgroundMusic.stop()`
2. æ—§éŸ³ä¹å®ä¾‹è™½åœ¨å†…å­˜ä¸­ï¼Œä½†å·²åœæ­¢æ’­æ”¾
3. åªæœ‰æ–°åˆ›å»ºçš„å®ä¾‹åœ¨æ’­æ”¾

**æ³„æ¼å½±å“**ï¼š
- å ç”¨å†…å­˜ç©ºé—´ï¼ˆæ¯æ¬¡é‡å¯ ~10-20 MBï¼‰
- é•¿æ—¶é—´æ¸¸ç©å¯èƒ½å¯¼è‡´æµè§ˆå™¨å¡é¡¿æˆ–å´©æºƒ
- ä½ç«¯è®¾å¤‡å½±å“æ›´æ˜æ˜¾

### Phaser çš„ `destroy()` vs `removeAll()`

- `sound.destroy()` - ä¸ä¼šç«‹å³ä» SoundManager çš„æ•°ç»„ä¸­ç§»é™¤
- `sound.removeAll()` - ç«‹å³æ¸…ç©ºæ‰€æœ‰éŸ³ä¹å®ä¾‹ï¼Œæ˜¯æ­£ç¡®çš„ä¿®å¤æ–¹å¼

---

## ç›¸å…³æ–‡ä»¶

- `src/scenes/GameScene.js` - ä¸»è¦æ¸¸æˆé€»è¾‘å’Œä¿®å¤ä»£ç 
- `src/config/GameConfig.js` - æ¸¸æˆé…ç½®å‚æ•°

---

**æ€»ç»“**ï¼šé€šè¿‡å®é™…æµ‹è¯•å‘ç°éŸ³ä¹å®ä¾‹æ³„æ¼ï¼Œç»è¿‡å¤šæ¬¡å°è¯•åä½¿ç”¨ `sound.removeAll()` æˆåŠŸä¿®å¤ã€‚åŒæ—¶æ”¹è¿›äº†æš‚åœåŠŸèƒ½å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œä»£ç æ›´åŠ å¥å£®ã€‚
